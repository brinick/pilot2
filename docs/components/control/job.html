
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>job &#8212; Pilot 2  documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="monitor" href="monitor.html" />
    <link rel="prev" title="data" href="data.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-pilot.control.job">
<span id="job"></span><h1>job<a class="headerlink" href="#module-pilot.control.job" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="pilot.control.job._validate_job">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">_validate_job</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#_validate_job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job._validate_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify job parameters for specific problems.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Boolean.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.add_error_codes">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">add_error_codes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#add_error_codes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.add_error_codes" title="Permalink to this definition">¶</a></dt>
<dd><p>Add error codes to data structure.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – data dictionary.</p></li>
<li><p><strong>job</strong> – job object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.add_memory_info">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">add_memory_info</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">workdir</span></em>, <em class="sig-param"><span class="n">name</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#add_memory_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.add_memory_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Add memory information (if available) to the data structure that will be sent to the server with job updates
Note: this function updates the data dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – data structure (dictionary).</p></li>
<li><p><strong>workdir</strong> – working directory of the job (string).</p></li>
<li><p><strong>name</strong> – name of memory monitor (string).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.add_timing_and_extracts">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">add_timing_and_extracts</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">state</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#add_timing_and_extracts"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.add_timing_and_extracts" title="Permalink to this definition">¶</a></dt>
<dd><p>Add timing info and log extracts to data structure for a completed job (finished or failed) to be sent to server.
Note: this function updates the data dictionary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>data</strong> – data structure (dictionary).</p></li>
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>state</strong> – state of the job (string).</p></li>
<li><p><strong>args</strong> – pilot args.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.check_for_abort_job">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">check_for_abort_job</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">caller</span><span class="o">=</span><span class="default_value">''</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#check_for_abort_job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.check_for_abort_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if args.abort_job.is_set().
This flag should</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p></li>
<li><p><strong>caller</strong> – function name of caller (string).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Boolean, True if args_job.is_set()</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.check_job_monitor_waiting_time">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">check_job_monitor_waiting_time</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">peeking_time</span></em>, <em class="sig-param"><span class="n">abort_override</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#check_job_monitor_waiting_time"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.check_job_monitor_waiting_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Check the waiting time in the job monitor.
Set global graceful_stop if necessary.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – args object.</p></li>
<li><p><strong>peeking_time</strong> – time when monitored_payloads queue was peeked into (int).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.control">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">control</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">traces</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#control"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.control" title="Permalink to this definition">¶</a></dt>
<dd><p>Main function of job control.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – internal queues for job handling.</p></li>
<li><p><strong>traces</strong> – tuple containing internal pilot states.</p></li>
<li><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.create_data_payload">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">create_data_payload</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">traces</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#create_data_payload"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.create_data_payload" title="Permalink to this definition">¶</a></dt>
<dd><p>(add description)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – </p></li>
<li><p><strong>traces</strong> – </p></li>
<li><p><strong>args</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.create_job">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">create_job</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">dispatcher_response</span></em>, <em class="sig-param"><span class="n">queue</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#create_job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.create_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a job object out of the dispatcher response.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>dispatcher_response</strong> – raw job dictionary from the dispatcher.</p></li>
<li><p><strong>queue</strong> – queue name (string).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>job object</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.fail_monitored_job">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">fail_monitored_job</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">exit_code</span></em>, <em class="sig-param"><span class="n">diagnostics</span></em>, <em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">traces</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#fail_monitored_job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.fail_monitored_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Fail a monitored job.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job</strong> – job object</p></li>
<li><p><strong>exit_code</strong> – exit code from job_monitor_tasks (int).</p></li>
<li><p><strong>diagnostics</strong> – pilot error diagnostics (string).</p></li>
<li><p><strong>queues</strong> – queues object.</p></li>
<li><p><strong>traces</strong> – traces object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_cpu_consumption_time">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_cpu_consumption_time</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">cpuconsumptiontime</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_cpu_consumption_time"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_cpu_consumption_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the CPU consumption time.
The function makes sure that the value exists and is within allowed limits (&lt; 10^9).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>cpuconsumptiontime</strong> – CPU consumption time (int/None).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>properly set CPU consumption time (int/None).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_data_structure">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_data_structure</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">state</span></em>, <em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">xml</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">metadata</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_data_structure"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_data_structure" title="Permalink to this definition">¶</a></dt>
<dd><p>Build the data structure needed for getJob, updateJob.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>state</strong> – state of the job (string).</p></li>
<li><p><strong>args</strong> – </p></li>
<li><p><strong>xml</strong> – optional XML string.</p></li>
<li><p><strong>metadata</strong> – job report metadata read as a string.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>data structure (dictionary).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_dispatcher_dictionary">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_dispatcher_dictionary</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_dispatcher_dictionary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_dispatcher_dictionary" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a dictionary with required fields for the dispatcher getJob operation.</p>
<p>The dictionary should contain the following fields: siteName, computingElement (queue name),
prodSourceLabel (e.g. user, test, ptest), diskSpace (available disk space for a job in MB),
workingGroup, countryGroup, cpu (float), mem (float) and node (worker node name).</p>
<p>workingGroup, countryGroup and allowOtherCountry
we add a new pilot setting allowOtherCountry=True to be used in conjunction with countryGroup=us for
US pilots. With these settings, the Panda server will produce the desired behaviour of dedicated X% of
the resource exclusively (so long as jobs are available) to countryGroup=us jobs. When allowOtherCountry=false
this maintains the behavior relied on by current users of the countryGroup mechanism – to NOT allow
the resource to be used outside the privileged group under any circumstances.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>args</strong> – arguments (e.g. containing queue name, queuedata dictionary, etc).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>dictionary prepared for the dispatcher getJob operation.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_fake_job">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_fake_job</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">input</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_fake_job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_fake_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a job definition for internal pilot testing.
Note: this function is only used for testing purposes. The job definitions below are ATLAS specific.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>input</strong> – Boolean, set to False if no input files are wanted</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>job definition (dictionary).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_finished_or_failed_job">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_finished_or_failed_job</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">queues</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_finished_or_failed_job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_finished_or_failed_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if the job has either finished or failed and if so return it.
If failed, order a log transfer. If the job is in state ‘failed’ and abort_job is set, set job_aborted.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – pilot args object.</p></li>
<li><p><strong>queues</strong> – pilot queues object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>job object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_heartbeat_period">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_heartbeat_period</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">debug</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_heartbeat_period"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_heartbeat_period" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the proper heartbeat period, as determined by normal or debug mode.
In normal mode, the heartbeat period is 30*60 s, while in debug mode it is 5*60 s. Both values are defined in the
config file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>debug</strong> – Boolean, True for debug mode. False otherwise.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>heartbeat period (int).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_job_definition">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_job_definition</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_job_definition"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_job_definition" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a job definition from a source (server or pre-placed local file).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>job definition dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_job_definition_from_file">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_job_definition_from_file</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">path</span></em>, <em class="sig-param"><span class="n">harvester</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_job_definition_from_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_job_definition_from_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a job definition from a pre-placed file.
In Harvester mode, also remove any existing job request files since it is no longer needed/wanted.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>path</strong> – path to job definition file.</p></li>
<li><p><strong>harvester</strong> – True if Harvester is being used (determined from args.harvester), otherwise False</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>job definition dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_job_definition_from_server">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_job_definition_from_server</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_job_definition_from_server"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_job_definition_from_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Get a job definition from a server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>job definition dictionary.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_job_from_queue">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_job_from_queue</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">state</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_job_from_queue"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_job_from_queue" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if the job has finished or failed and if so return it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – pilot queues.</p></li>
<li><p><strong>state</strong> – job state (e.g. finished/failed) (string).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>job object.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_job_label">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_job_label</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_job_label"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_job_label" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a proper job label.
The function returns a job label that corresponds to the actual pilot version, ie if the pilot is a development
version (ptest or rc_test2) or production version (managed or user).
Example: -i RC -&gt; job_label = rc_test2.
NOTE: it should be enough to only use the job label, -j rc_test2 (and not specify -i RC at all).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>args</strong> – pilot args object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>job_label (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_job_retrieval_delay">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_job_retrieval_delay</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">harvester</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_job_retrieval_delay"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_job_retrieval_delay" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the proper delay between job retrieval attempts.
In Harvester mode, the pilot will look once per second for a job definition file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>harvester</strong> – True if Harvester is being used (determined from args.harvester), otherwise False</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>sleep (s)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_job_status">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_job_status</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">key</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_job_status"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_job_status" title="Permalink to this definition">¶</a></dt>
<dd><p>Wrapper function around job.get_status().
If key = ‘LOG_TRANSFER’ but job object is not defined, the function will return value = LOG_TRANSFER_NOT_DONE.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>key</strong> – key name (string).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>value (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_job_status_from_server">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_job_status_from_server</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job_id</span></em>, <em class="sig-param"><span class="n">url</span></em>, <em class="sig-param"><span class="n">port</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_job_status_from_server"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_job_status_from_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the current status of job &lt;jobId&gt; from the dispatcher.
typical dispatcher response: ‘status=finished&amp;StatusCode=0’
StatusCode  0: succeeded</p>
<blockquote>
<div><p>10: time-out
20: general error
30: failed</p>
</div></blockquote>
<p>In the case of time-out, the dispatcher will be asked one more time after 10 s.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job_id</strong> – PanDA job id (int).</p></li>
<li><p><strong>url</strong> – PanDA server URL (string).</p></li>
<li><p><strong>port</strong> – PanDA server port (int).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>status (string; e.g. holding), attempt_nr (int), status_code (int)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_list_of_log_files">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_list_of_log_files</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_list_of_log_files"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_list_of_log_files" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of log files produced by the payload.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>list of log files.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_panda_server">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_panda_server</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">url</span></em>, <em class="sig-param"><span class="n">port</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_panda_server"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_panda_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the URL for the PanDA server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – URL string, if set in pilot option (port not included).</p></li>
<li><p><strong>port</strong> – port number, if set in pilot option (int).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>full URL (either from pilot options or from config file)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_payload_log_tail">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_payload_log_tail</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_payload_log_tail"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_payload_log_tail" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the tail of the payload stdout or its latest updated log file.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>tail of stdout (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_proper_state">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_proper_state</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">state</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_proper_state"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_proper_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a proper job state to send to server.
This function should only return ‘starting’, ‘running’, ‘finished’, ‘holding’ or ‘failed’.
If the internal job.serverstate is not yet set, it means it is the first server update, ie ‘starting’ should be
sent.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>state</strong> – internal pilot state (string).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>valid server state (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.get_task_id">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">get_task_id</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#get_task_id"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.get_task_id" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the task id for the current job.
Note: currently the implementation uses an environmental variable to store this number (PanDA_TaskID).</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>task id (string). Returns empty string in case of error.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.getjob_server_command">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">getjob_server_command</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">url</span></em>, <em class="sig-param"><span class="n">port</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#getjob_server_command"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.getjob_server_command" title="Permalink to this definition">¶</a></dt>
<dd><p>Prepare the getJob server command.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>url</strong> – PanDA server URL (string)</p></li>
<li><p><strong>port</strong> – PanDA server port</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>full server command (URL string)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.handle_backchannel_command">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">handle_backchannel_command</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">res</span></em>, <em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#handle_backchannel_command"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.handle_backchannel_command" title="Permalink to this definition">¶</a></dt>
<dd><p>Does the server update contain any backchannel information? if so, update the job object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>res</strong> – server response (dictionary).</p></li>
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>args</strong> – pilot args object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.has_job_completed">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">has_job_completed</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#has_job_completed"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.has_job_completed" title="Permalink to this definition">¶</a></dt>
<dd><p>Has the current job completed (finished or failed)?
Note: the job object was extracted from monitored_payloads queue before this function was called.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>queues</strong> – Pilot queues object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True is the payload has finished or failed</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.interceptor">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">interceptor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">traces</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#interceptor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.interceptor" title="Permalink to this definition">¶</a></dt>
<dd><p>MOVE THIS TO INTERCEPTOR.PY; TEMPLATE FOR THREADS</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – internal queues for job handling.</p></li>
<li><p><strong>traces</strong> – tuple containing internal pilot states.</p></li>
<li><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.is_queue_empty">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">is_queue_empty</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">q</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#is_queue_empty"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.is_queue_empty" title="Permalink to this definition">¶</a></dt>
<dd><p>Check if the given queue is empty (without pulling).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – pilot queues object.</p></li>
<li><p><strong>q</strong> – queue name (string).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if queue is empty, False otherwise</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.job_monitor">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">job_monitor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">traces</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#job_monitor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.job_monitor" title="Permalink to this definition">¶</a></dt>
<dd><p>Monitoring of job parameters.
This function monitors certain job parameters, such as job looping, at various time intervals. The main loop
is executed once a minute, while individual verifications may be executed at any time interval (&gt;= 1 minute). E.g.
looping jobs are checked once per ten minutes (default) and the heartbeat is send once per 30 minutes. Memory
usage is checked once a minute.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – internal queues for job handling.</p></li>
<li><p><strong>traces</strong> – tuple containing internal pilot states.</p></li>
<li><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.locate_job_definition">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">locate_job_definition</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#locate_job_definition"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.locate_job_definition" title="Permalink to this definition">¶</a></dt>
<dd><p>Locate the job definition file among standard locations.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>path (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.make_job_report">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">make_job_report</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#make_job_report"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.make_job_report" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a summary report for the given job.
This function is called when the job has completed.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.order_log_transfer">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">order_log_transfer</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#order_log_transfer"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.order_log_transfer" title="Permalink to this definition">¶</a></dt>
<dd><p>Order a log transfer for a failed job.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – pilot queues object.</p></li>
<li><p><strong>job</strong> – job object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.pause_queue_monitor">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">pause_queue_monitor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">delay</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#pause_queue_monitor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.pause_queue_monitor" title="Permalink to this definition">¶</a></dt>
<dd><p>Pause the queue monitor to let log transfer complete.
Note: this function should use globally available object. Use sleep for now.
:param delay: sleep time in seconds (int).
:return:</p>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.print_node_info">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">print_node_info</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#print_node_info"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.print_node_info" title="Permalink to this definition">¶</a></dt>
<dd><p>Print information about the local node to the log.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.proceed_with_getjob">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">proceed_with_getjob</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">timefloor</span></em>, <em class="sig-param"><span class="n">starttime</span></em>, <em class="sig-param"><span class="n">jobnumber</span></em>, <em class="sig-param"><span class="n">getjob_requests</span></em>, <em class="sig-param"><span class="n">harvester</span></em>, <em class="sig-param"><span class="n">verify_proxy</span></em>, <em class="sig-param"><span class="n">traces</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#proceed_with_getjob"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.proceed_with_getjob" title="Permalink to this definition">¶</a></dt>
<dd><p>Can we proceed with getjob?
We may not proceed if we have run out of time (timefloor limit), if the proxy is too short, if disk space is too
small or if we have already proceed enough jobs.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>timefloor</strong> – timefloor limit (s)</p></li>
<li><p><strong>starttime</strong> – start time of retrieve() (s)</p></li>
<li><p><strong>jobnumber</strong> – number of downloaded jobs</p></li>
<li><p><strong>getjob_requests</strong> – number of getjob requests</p></li>
<li><p><strong>harvester</strong> – True if Harvester is used, False otherwise. Affects the max number of getjob reads (from file).</p></li>
<li><p><strong>verify_proxy</strong> – True if the proxy should be verified. False otherwise.</p></li>
<li><p><strong>traces</strong> – traces object (to be able to propagate a proxy error all the way back to the wrapper).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Boolean.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.publish_harvester_reports">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">publish_harvester_reports</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">state</span></em>, <em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">data</span></em>, <em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">final</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#publish_harvester_reports"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.publish_harvester_reports" title="Permalink to this definition">¶</a></dt>
<dd><p>Publish all reports needed by Harvester.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>state</strong> – job state (string).</p></li>
<li><p><strong>args</strong> – pilot args object.</p></li>
<li><p><strong>data</strong> – data structure for server update (dictionary).</p></li>
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>final</strong> – is this the final update? (Boolean).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if successful, False otherwise (Boolean).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.queue_monitor">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">queue_monitor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">traces</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#queue_monitor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.queue_monitor" title="Permalink to this definition">¶</a></dt>
<dd><p>Monitoring of queues.
This function monitors queue activity, specifically if a job has finished or failed and then reports to the server.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – internal queues for job handling.</p></li>
<li><p><strong>traces</strong> – tuple containing internal pilot states.</p></li>
<li><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.retrieve">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">retrieve</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">traces</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#retrieve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.retrieve" title="Permalink to this definition">¶</a></dt>
<dd><p>Retrieve all jobs from a source.</p>
<p>The job definition is a json dictionary that is either present in the launch
directory (preplaced) or downloaded from a server specified by <code class="xref any docutils literal notranslate"><span class="pre">args.url</span></code>.</p>
<p>The function retrieves the job definition from the proper source and places
it in the <code class="xref any docutils literal notranslate"><span class="pre">queues.jobs</span></code> queue.</p>
<p>WARNING: this function is nearly too complex. Be careful with adding more lines as flake8 will fail it.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – internal queues for job handling.</p></li>
<li><p><strong>traces</strong> – tuple containing internal pilot states.</p></li>
<li><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p></li>
</ul>
</dd>
<dt class="field-even">Raises</dt>
<dd class="field-even"><p><a class="reference internal" href="../common/exception.html#pilot.common.exception.PilotException" title="pilot.common.exception.PilotException"><strong>PilotException</strong></a> – if create_job fails (e.g. because queuedata could not be downloaded).</p>
</dd>
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.send_heartbeat_if_time">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">send_heartbeat_if_time</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">update_time</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#send_heartbeat_if_time"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.send_heartbeat_if_time" title="Permalink to this definition">¶</a></dt>
<dd><p>Send a heartbeat to the server if it is time to do so.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>args</strong> – args object.</p></li>
<li><p><strong>update_time</strong> – last update time (from time.time()).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>possibly updated update_time (from time.time()).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.send_state">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">send_state</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">state</span></em>, <em class="sig-param"><span class="n">xml</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">metadata</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#send_state"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.send_state" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the server (send heartbeat message).
Interpret and handle any server instructions arriving with the updateJob back channel.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p></li>
<li><p><strong>state</strong> – job state (string).</p></li>
<li><p><strong>xml</strong> – optional metadata xml (string).</p></li>
<li><p><strong>metadata</strong> – job report metadata read as a string.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>boolean (True if successful, False otherwise).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.store_jobid">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">store_jobid</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">jobid</span></em>, <em class="sig-param"><span class="n">init_dir</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#store_jobid"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.store_jobid" title="Permalink to this definition">¶</a></dt>
<dd><p>Store the PanDA job id in a file that can be picked up by the wrapper for other reporting.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>jobid</strong> – job id (int).</p></li>
<li><p><strong>init_dir</strong> – pilot init dir (string).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.update_server">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">update_server</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#update_server"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.update_server" title="Permalink to this definition">¶</a></dt>
<dd><p>Update the server (wrapper for send_state() that also prepares the metadata).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>args</strong> – pilot args object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.validate">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">validate</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">traces</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#validate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.validate" title="Permalink to this definition">¶</a></dt>
<dd><p>(add description)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queues</strong> – </p></li>
<li><p><strong>traces</strong> – </p></li>
<li><p><strong>args</strong> – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.verify_error_code">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">verify_error_code</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#verify_error_code"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.verify_error_code" title="Permalink to this definition">¶</a></dt>
<dd><p>Make sure an error code is properly set.
This makes sure that job.piloterrorcode is always set for a failed/holding job, that not only
job.piloterrorcodes are set but not job.piloterrorcode. This function also negates the sign of the error code
and sets job state ‘holding’ (instead of ‘failed’) if the error is found to be recoverable by a later job (user
jobs only).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.wait_for_aborted_job_stageout">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">wait_for_aborted_job_stageout</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">args</span></em>, <em class="sig-param"><span class="n">queues</span></em>, <em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#wait_for_aborted_job_stageout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.wait_for_aborted_job_stageout" title="Permalink to this definition">¶</a></dt>
<dd><p>Wait for stage-out to finish for aborted job.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>args</strong> – pilot args object.</p></li>
<li><p><strong>queues</strong> – pilot queues object.</p></li>
<li><p><strong>job</strong> – job object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.control.job.write_heartbeat_to_file">
<code class="sig-prename descclassname">pilot.control.job.</code><code class="sig-name descname">write_heartbeat_to_file</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">data</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/control/job.html#write_heartbeat_to_file"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.control.job.write_heartbeat_to_file" title="Permalink to this definition">¶</a></dt>
<dd><p>Write heartbeat dictionary to file.
This is only done when server updates are not wanted.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>data</strong> – server data (dictionary).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>True if successful, False otherwise (Boolean).</p>
</dd>
</dl>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Pilot 2</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api/index.html">api components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common/index.html">common components</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">control components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../copytool/index.html">copytool components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../eventservice/index.html">eventservice components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../info/index.html">info components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resource/index.html">resource components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/index.html">user components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../util/index.html">util components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/index.html">workflow components</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Components</a><ul>
  <li><a href="index.html">control components</a><ul>
      <li>Previous: <a href="data.html" title="previous chapter">data</a></li>
      <li>Next: <a href="monitor.html" title="next chapter">monitor</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/components/control/job.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Paul Nilsson, Mario Lassnig, Daniil Drizhuk, ....
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/components/control/job.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>