
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>monitoring &#8212; Pilot 2  documentation</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="monitoringtime" href="monitoringtime.html" />
    <link rel="prev" title="math" href="math.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="module-pilot.util.monitoring">
<span id="monitoring"></span><h1>monitoring<a class="headerlink" href="#module-pilot.util.monitoring" title="Permalink to this headline">¶</a></h1>
<dl class="py function">
<dt id="pilot.util.monitoring.check_local_space">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">check_local_space</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#check_local_space"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.check_local_space" title="Permalink to this definition">¶</a></dt>
<dd><p>Do we have enough local disk space left to run the job?</p>
<dl class="field-list simple">
<dt class="field-odd">Returns</dt>
<dd class="field-odd"><p>pilot error code (0 if success, NOLOCALSPACE if failure)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.check_output_file_sizes">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">check_output_file_sizes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#check_output_file_sizes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.check_output_file_sizes" title="Permalink to this definition">¶</a></dt>
<dd><p>Are the output files within the allowed size limits?</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>exit code (int), error diagnostics (string)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.check_payload_stdout">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">check_payload_stdout</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#check_payload_stdout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.check_payload_stdout" title="Permalink to this definition">¶</a></dt>
<dd><p>Check the size of the payload stdout.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>exit code (int), diagnostics (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.check_work_dir">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">check_work_dir</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#check_work_dir"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.check_work_dir" title="Permalink to this definition">¶</a></dt>
<dd><p>Check the size of the work directory.
The function also updates the workdirsizes list in the job object.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>exit code (int), error diagnostics (string)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.get_local_size_limit_stdout">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">get_local_size_limit_stdout</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">bytes</span><span class="o">=</span><span class="default_value">True</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#get_local_size_limit_stdout"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.get_local_size_limit_stdout" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a proper value for the local size limit for payload stdout (from config file).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>bytes</strong> – boolean (if True, convert kB to Bytes).</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>size limit (int).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.get_max_allowed_work_dir_size">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">get_max_allowed_work_dir_size</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queuedata</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#get_max_allowed_work_dir_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.get_max_allowed_work_dir_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return the maximum allowed size of the work directory.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>queuedata</strong> – job.infosys.queuedata object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>max allowed work dir size in Bytes (int).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.get_max_input_size">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">get_max_input_size</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">queuedata</span></em>, <em class="sig-param"><span class="n">megabyte</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#get_max_input_size"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.get_max_input_size" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a proper maxinputsize value.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>queuedata</strong> – job.infosys.queuedata object.</p></li>
<li><p><strong>megabyte</strong> – return results in MB (Boolean).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>max input size (int).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.job_monitor_tasks">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">job_monitor_tasks</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em>, <em class="sig-param"><span class="n">mt</span></em>, <em class="sig-param"><span class="n">args</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#job_monitor_tasks"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.job_monitor_tasks" title="Permalink to this definition">¶</a></dt>
<dd><p>Perform the tasks for the job monitoring.
The function is called once a minute. Individual checks will be performed at any desired time interval (&gt;= 1
minute).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>job</strong> – job object.</p></li>
<li><p><strong>mt</strong> – <a class="reference internal" href="monitoringtime.html#pilot.util.monitoringtime.MonitoringTime" title="pilot.util.monitoringtime.MonitoringTime"><code class="xref any py py-class docutils literal notranslate"><span class="pre">MonitoringTime</span></code></a> object.</p></li>
<li><p><strong>args</strong> – Pilot arguments (e.g. containing queue name, queuedata dictionary, etc).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>exit code (int), diagnostics (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.set_number_used_cores">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">set_number_used_cores</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#set_number_used_cores"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.set_number_used_cores" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the number of cores used by the payload.
The number of actual used cores is reported with job metrics (if set).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.utility_monitor">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">utility_monitor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#utility_monitor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.utility_monitor" title="Permalink to this definition">¶</a></dt>
<dd><p>Make sure that any utility commands are still running.
In case a utility tool has crashed, this function may restart the process.
The function is used by the job monitor thread.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><p><strong>job</strong> – job object.</p>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p></p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.verify_disk_usage">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">verify_disk_usage</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">current_time</span></em>, <em class="sig-param"><span class="n">mt</span></em>, <em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#verify_disk_usage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.verify_disk_usage" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the disk usage.
The function checks 1) payload stdout size, 2) local space, 3) work directory size, 4) output file sizes.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>current_time</strong> – current time at the start of the monitoring loop (int).</p></li>
<li><p><strong>mt</strong> – measured time object.</p></li>
<li><p><strong>job</strong> – job object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>exit code (int), error diagnostics (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.verify_looping_job">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">verify_looping_job</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">current_time</span></em>, <em class="sig-param"><span class="n">mt</span></em>, <em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#verify_looping_job"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.verify_looping_job" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify that the job is not looping.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>current_time</strong> – current time at the start of the monitoring loop (int).</p></li>
<li><p><strong>mt</strong> – measured time object.</p></li>
<li><p><strong>job</strong> – job object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>exit code (int), error diagnostics (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.verify_memory_usage">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">verify_memory_usage</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">current_time</span></em>, <em class="sig-param"><span class="n">mt</span></em>, <em class="sig-param"><span class="n">job</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#verify_memory_usage"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.verify_memory_usage" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the memory usage (optional).
Note: this function relies on a stand-alone memory monitor tool that may be executed by the Pilot.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>current_time</strong> – current time at the start of the monitoring loop (int).</p></li>
<li><p><strong>mt</strong> – measured time object.</p></li>
<li><p><strong>job</strong> – job object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>exit code (int), error diagnostics (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.verify_running_processes">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">verify_running_processes</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">current_time</span></em>, <em class="sig-param"><span class="n">mt</span></em>, <em class="sig-param"><span class="n">pid</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#verify_running_processes"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.verify_running_processes" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the number of running processes.
The function sets the environmental variable PILOT_MAXNPROC to the maximum number of found (child) processes
corresponding to the main payload process id.
The function does not return an error code (always returns exit code 0).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>current_time</strong> – current time at the start of the monitoring loop (int).</p></li>
<li><p><strong>mt</strong> – measured time object.</p></li>
<li><p><strong>pid</strong> – payload process id (int).</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>exit code (int), error diagnostics (string).</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt id="pilot.util.monitoring.verify_user_proxy">
<code class="sig-prename descclassname">pilot.util.monitoring.</code><code class="sig-name descname">verify_user_proxy</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">current_time</span></em>, <em class="sig-param"><span class="n">mt</span></em><span class="sig-paren">)</span><a class="reference internal" href="../../_modules/pilot/util/monitoring.html#verify_user_proxy"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#pilot.util.monitoring.verify_user_proxy" title="Permalink to this definition">¶</a></dt>
<dd><p>Verify the user proxy.
This function is called by the job_monitor_tasks() function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>current_time</strong> – current time at the start of the monitoring loop (int).</p></li>
<li><p><strong>mt</strong> – measured time object.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>exit code (int), error diagnostics (string).</p>
</dd>
</dl>
</dd></dl>

</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">Pilot 2</a></h1>








<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Getting started</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Components</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../api/index.html">api components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../common/index.html">common components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../control/index.html">control components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../copytool/index.html">copytool components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../eventservice/index.html">eventservice components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../info/index.html">info components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../resource/index.html">resource components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../user/index.html">user components</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">util components</a></li>
<li class="toctree-l2"><a class="reference internal" href="../workflow/index.html">workflow components</a></li>
</ul>
</li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Components</a><ul>
  <li><a href="index.html">util components</a><ul>
      <li>Previous: <a href="math.html" title="previous chapter">math</a></li>
      <li>Next: <a href="monitoringtime.html" title="next chapter">monitoringtime</a></li>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/components/util/monitoring.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2017, Paul Nilsson, Mario Lassnig, Daniil Drizhuk, ....
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.3.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../../_sources/components/util/monitoring.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>